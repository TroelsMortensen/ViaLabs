@page "/EditGuide/{GuideId:guid}"
@using BlazorServerUI.MarkdownConvert
@using Dispatcher
@using ViewData.ProfileInfo.DTOs
@using ViewData.ProfileInfo.Queries
@inject IQueryDispatcher QueryDispatcher

<div class="outermost-box">
    <div class="top-row-box">
        <div class="top-row-left"></div>
        <div class="top-row-right"></div>
    </div>
    <div class="content-box">
        <div class="left-side-box">
            <div class="guide-details-box">
                
            </div>
            <div class="steps-box">
                
            </div>
        </div>        
        <div class="right-side-box">
            <div class="markdown-editor-box"></div>
            <div class="result-display-box"></div>
        </div>
    </div>
</div>
@* <div style="min-width: 45%;"> *@
@*     <div style="margin:10px"> *@
@*         <button>Preview</button> *@
@*         <button>Save</button> *@
@*         <input type="checkbox"/> *@
@*         <label>Autosave</label> *@
@*     </div> *@
@*     <div style="min-width: 45%;"> *@
@*         <MarkdownEditor @bind-Value="@markdownValue" *@
@*                         ValueHTMLChanged="@MdToHtml" *@
@*                         CustomButtonClicked="OnCustomButtonClicked" *@
@*                         ImageUploadEndpoint="" *@
@*                         ImageUploadChanged="@OnImageUploadChanged" *@
@*                         ImageUploadStarted="@OnImageUploadStarted" *@
@*                         ImageUploadProgressed="@OnImageUploadProgressed" *@
@*                         ImageUploadEnded="@OnImageUploadEnded" *@
@*                         UploadImage="true"> *@
@*             $1$ <Toolbar> #1# *@
@*             $1$     <MarkdownToolbarButton Name="Test" Icon="fa fa-bolt" Action="MarkdownAction.Bold"/> #1# *@
@*             $1$     <MarkdownToolbarButton Separator Name="CustomImageUpload" Icon="fa fa-star" Title="My Image upload" /> #1# *@
@*             $1$ </Toolbar> #1# *@
@*         </MarkdownEditor> *@
@*     </div> *@
@* </div> *@
@* <div style="min-width: 45%; min-height: 600px; background-color: #e0fbff"> *@
@*     @slideContent *@
@* </div> *@

@code
{
    [Parameter]
    public Guid GuideId { get; set; }
    
    private string markdownValue = String.Empty;

    private MarkupString slideContent;
    private readonly MarkdigAdapter converter = new();

    private GuideDataVM guide = null!;
    
    protected override async Task OnInitializedAsync()
    {
        guide = await QueryDispatcher.QueryAsync(new GuideDataForEditQuery(GuideId));
    }

    private Task MdToHtml(string mdSource)
    {
        slideContent = (MarkupString)converter.ConvertMdToHtml(mdSource);
        return Task.CompletedTask;
    }

    Task OnImageUploadChanged(FileChangedEventArgs e)
    {
        this.StateHasChanged();
        return Task.CompletedTask;
    }

    Task OnImageUploadStarted(FileStartedEventArgs e)
    {
        Console.WriteLine($"Started Image: {e.File.Name}");
        return Task.CompletedTask;
    }

    Task OnImageUploadProgressed(FileProgressedEventArgs e)
    {
        Console.WriteLine($"Image: {e.File.Name} Progress: {(int)e.Percentage}");
        return Task.CompletedTask;
    }

    Task OnImageUploadEnded(FileEndedEventArgs e)
    {
        Console.WriteLine($"Finished Image: {e.File.Name}, Success: {e.Success}");
        return Task.CompletedTask;
    }

    private Task OnCustomButtonClicked(MarkdownButtonEventArgs args)
    {
        throw new NotImplementedException();
    }

}