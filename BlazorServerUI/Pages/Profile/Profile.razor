@page "/Profile"
@using BlazorServerUI.Handlers
@using BlazorServerUI.StateContainers.Profile
@using Domain.Models
@using Application.Features.ProfileDataLogic.ProviderContracts
@using Application.Features.ProfileDataLogic.LogicContracts
@using Application.Features.DisplayProfileInfo
@using Application.Features.DisplayProfileInfo.DataProvider
@using Application.Features.DisplayProfileInfo.DTOs
@using Application.Features.DisplayProfileInfo.Logic
@inject IProfileDataHandler profileDataHandler
@inject IProfileDataProvider profileDataProvider
@inject ProfileStateContainer profileStateContainer

<div style="display:flex; justify-content: space-evenly">
    @* @if (approvedTeacher is not null)  TODO*@ 
    @* { *@
    @*     <CategoriesOverview/> *@
    @* } *@
   
    <ProfileCard ApprovedTeacher="@approvedTeacher" UserName="@userName" IsViaTeacher="@isViaTeacher"/> 

</div>

@code {

    [CascadingParameter]
    public Task<AuthenticationState> AuthStateTask { get; set; } = null!;

    private string userName = String.Empty;
    private bool isViaTeacher;
    private TeacherHeaderDto? approvedTeacher;

    protected override async Task OnInitializedAsync()
    {
        AuthenticationState authState = await AuthStateTask;
        userName = authState.User.Identity?.Name!;
        isViaTeacher = profileDataHandler.IsViaTeacher(userName);
        if (!isViaTeacher) return;

        approvedTeacher = await profileDataProvider.GetTeacherAsync(userName);
        if (approvedTeacher != null)
        {
           await profileStateContainer.PopulateAsync(approvedTeacher.Name);
        }
    // TODO catch exceptions here, and show toast error message
    }

}